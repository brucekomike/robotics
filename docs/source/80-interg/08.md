# 第八章 工业机器人仿真软件高级应用

## 本章学习要点

### 本章学习提要:
第五、六、七章介绍了RAPID语言的数据结构、编程基础以及高级编程，但主要针对基于示教器的在线编程。本章将介绍仿真软件RobotStudio的高级应用，这是离线编程的基础。主要包括工业机器人离线编程基础知识、虚拟工作站搭建与编程，以及工业机器人的在线编程与控制。

## 本章目标

* 熟悉掌握仿真软件离线编程方法
* 熟悉掌握虚拟工业机器人工具的创建与设定
* 了解事件管理器的用法
* 掌握事件管理器控制工具姿态改变的知识
* 熟悉Smart组件的用法
* 掌握Smart组件输送机和动态工具的创建知识
* 掌握导轨和变位机的应用及编程方法
* 掌握工业机器人在线控制与编程的知识

## 内容简介

1.  离线轨迹编程
2.  自定义机器人工具
3.  事件管理器
4.  Smart组件技术
5.  导轨与变位机应用

---

## Smart组件技术

### Smart 组件
使用事件管理器制作装备的仿真动画比较容易，但是可设置的动画相对单一，逻辑也相对简单。Smart组件相对于事件管理器具有更强大的动画仿真功能，除了能够仿真机械运动效果外，还能够具备关联复杂的工作站逻辑、添加传感器、编辑物料属性等功能。

**事件管理器与smart组件对比表**

|       | 事件管理器              | Smart组件                    |
| :---- | :---------------------- | :--------------------------- |
| 使用难度 | 简单，易掌握            | 需要系统学习                 |
| 适用范围 | 简单动作改变的动画    | 复杂，需要逻辑控制的动画仿真 |
| 特点    | 适合制作简单的动画      | 适合制作复杂的动画           |

### 1. 创建设备的Smart组件
在仿真软件中，上方选择【建模】功能选项卡中单击的【Smart组件】，创建一个Smart组件。名字默认名为“SmartComponent_1”。

### 2. 设置输送产品源
(1) smart组件中的子对象组件Source用于设定产品源，每当触发一次Source执行，都会自动生成一个产品源的复制品。此处将要物料输送产品“大工件”设为产品源，则每次触发后都会产生一个“大工件”的复制品。单击【添加组件】/【动作】/【Source】，创建一个"Source1”。
(2) 鼠标右击【Source】组件，单击【属性】，在左侧属性中的【Source】下拉选项单击选择“大工件”，单击【应用】。

### 3. 设置运动属性
(1) 设定输送机的运动属性步骤为：单击【添加组件】，选择【其他】列表中的【Queue】，默认命名为“Queue”。
(2) 先不设置“Queue”属性；继续单击【添加组件】选择【本体】列表的【LinearMover】。
(3) 通过查看，大工件所处于工作站世界坐标系的位置就是0,0,0，右击选择“LinearMover”属性，输送机要移动工件的方向在图中右侧方框处，是世界坐标系“Global”的“Y”方向，距离为470.84mm。
(4) 【LinearMover】参数设置。右击【LinearMover】组件，单击【属性】，【Object】移动对象选择“SmartComponent_1/ Queue1"; 世界坐标系Y的正方向是移动方向，在Y坐标处填写470.84; 速度设定位150, Reference(参考坐标系)鼠标下拉单击选择世界坐标系【Global】; 单击【Execute】设定为1被点亮为高电平开始移动对象; 单击【应用】。

### 4. 设置传感器
在实际生产中，输送机将物料输送到定位装置末端后会触发到位传感器，使系统得到物料到位的反馈信息，停止物料输送；而当物料被取走时，传感器信号会被重叠，系统就会控制输送机再次开启物料输送。
(1) 单击【添加组件】/【传感器】/【PlaneSensor】。
(2) 右击建立好的子组件【PlaneSensor】，单击属性，选择捕捉工具【捕捉端点】后，单击【Origin】下面的空白处，单击图中方框处的输送机物料定位机构的平面角点，然后输入图中【Axis1】和【Axis1】中的数据，单击【关闭】。
(3) 将可能与该传感器接触的周边设备的属性设为“不可由传感器检测”，右击组件，将【可由传感器检测】前面的“勾选”单击去掉，而工件“大工件”要设置为“可由传感器检测”。
**原因在于**，虚拟传感器一次智能检测一个物体，因此需保证所创建的传感器不能与周边设备接触，否则会无法检测运动到输送机末端的产品。出了在创建时尽量避开周边设备以外，通常的做法是将可能与该传感器接触的周边设备的属性设置为不可由传感器检测。
(1) 单击【添加组件】/【信号和属性】依次单击【LogicSRLatch】和【LogicGate】；单击【添加组件】/【其他】中单击【SimulationEvents】。LogicGate 进行两个信号的关联逻辑运算； LogicSRLatch是为了锁定信号；添加SimulationEvents是将开始仿真信号作为激活开始信号来用。
(2) 右击“LogicGate”组件，单击属性，编辑【属性:LogicGate】，【Operator】下拉选择“NOT”，单击【关闭】。

### 5. 设置属性连结
属性连接指各Smart子组件的某项属性之间的连接。例如：组件A中的某项属性a1与组件B中某项属性b1建立了属性连接。则当a1变化时，b1也会随着一起变化。属性连接在Smart组件视图中是【属性与连接】选项卡中设置。
(1) 单击【属性与连结】选项卡下单击【添加链接】；属性与连结里面【添加动态属性】用于创建动态属性以及编辑现有动态属性。
(2) 单击【添加连接】，在【编辑】界面，【源对象】选择“Source”，【源属性】选择“Copy”，【目标对象】选择前面创建的“Queue”，【目标属性】选择“back”，这里编辑方式所有地选择都是单击下拉菜单点选。
(上述属性连接中，源对象Source的属性Copy指的是源的复制品，目标对象Queue的属性back指的是下一个将要加入队列的物体。通过该属性连接，当产品源产生一个复制品执行加入队列动作后，该复制品就会自动加入到Queue中，由于Queue队列一直执行线性运动，因此该复制品也会随着队列进行线性运动，而当执行退出队列操作时，复制品退出队列后也会停止线性运动。)

### 6. 设置信号与连接
信号与连接包含I/O信号和I/O连接两部分,I/O信号指的是本工作站中自行创建的数字信号,用于和各个Smart子组件进行信号交互,I/O连接指的是创建的I/O信号与Smart子组件信号的连接关系,以及各Smart子组件之间的信号连接关系。信号与连接是在Smart组件窗口中的【信号与连接】选项卡中进行设置的。
物料输送设备Smart组件需要两个I/O信号,单击【添加I/O Signal】添加。

### 7. 验证仿真效果
(1) 首先单击【仿真】/【仿真设定】，在【仿真设定】页面去
掉控制器下面选项的勾选,保证Smart组件下选项被勾选。
(2) 在【仿真】功能选项卡中单击【I/O仿真器】,【选择系统】
/下拉单击选择【SmartComponent_1】。
(3) 单击“start”信号后,复制品运动到输送机末端,当大工
件触发末端传感器,“arrive”信号置1,输送机前端会再次产生一个
复制品,进入下一个循环。

---

## 1. 创建动态工具—Smart组件

在RobotStudio中创建仿真工作站,工具拾取与释放产品的动态效果最
为重要。除使用事件管理器设置以外,也可以使用Smart组件来创建动态工具。

(1) 首先将夹爪“bigtool-good”在从机器人上拆除,方便组件编辑,
编辑完成后在再安装上,。右击【bigtool-good】工具,单击【拆除】,
在弹出的【更新位置】菜单单击【否】。
(2) 【建模】功能选项卡中单击【Smart组件】,默认命名为
"SmartComponent_2”。
(3) 在【布局】窗口中,选中【bigtool-good】,拖放到
【SmartComponent_2】上面后松开,将【bigtool-good】添加到了
Smart组件中。在Smart【编辑组件】编辑窗口的【组成】选项卡中,右击
【bigtool-good】,勾选【设定为Role】。让Smart组件获得Role属性,
从而继承了机器人工具的坐标系等属性。

### 2. 设置工具传感器
(1) 添加组件,在Smart组件编辑窗口的单击【添加组件】/
【传感器】在列表中单击选择【LineSensor】,创建一个
LineSensor类型的传感器子组件。
(2) 在子组件线传感器“LineSensor”上右击,单击【属性】,设
定线传感器,需要指定起点Start和终点End。选取捕捉工具【捕捉中
心】,在【Start】下面空白处单击。
(3) 然后单击工具夹指底部中心点,线传感器用于检测工具是否抓到
物料,所以另个一点【End】为夹指的中间处,两个点连线如下图所示。
重新安装机器人工具时,工具坐标会发生偏移。虽然偏移不会影响工具的
安装,但传感器的Start点与End点的位置可能会产生偏差,又或者工具形状不
规则,无法通过鼠标捕捉确定End点。可以通过一下两种方法确定End点:
1) 分别排
结合St
2) 若难以
或两个坐标值,
高的位置,在
此基础
卡的/ End(mm)
EZEIN 【基本】选项
卡
传感器。
(4) 要避免在接触物体时LineSensor传感器全部浸入物体内部,以便
准确地检测到物体。可通过改变【Start】和【End】坐标来调整。
【Radius】设定线传感器半径,加粗便于观察,此处设为“3.00mm”。
【Active】置为“0”,暂时关闭传感器检测。
(5) 设置传感器后,仍需将工具设为“不可由传感器检测”,以免
传感器与工具发生干涉。bigtool-good单击右键,将【可由传感器检
测】,一项取消勾选。

### 3. 安装工具
鼠标选中【SmartComponent 2】Smart 组件拖放到机器人
[IRB1200_7_70_STD_01】上松开,将Smart工具安装到机器人末端,
接着在弹出的菜单中相继:单击【否】不更新组件位置;单击【是】替换
掉原先存在的工具数据。

### 4. 创建工具动作
(1) 首先使用子组件“Attacher”来设定拾取动作效果,然后添加
“Detacher”来设定拆除动作效果,步骤为:单击【添加组件】/【动作】,
分别单击添加【Attacher】和【Detacher】。
(2) 通过右击对应子组件
编辑属性,首先编辑新添加的
"Attacher" 子组件属性,安
装父对象和机械装置分别选工具
" SmartComponent_2/bigt
ool-good”和工具的坐标系
“bigtooljia”。安装对象不是
特定物体,则【Child】暂时不
作选择。
(3) 设定拆除的子对象,同样由于子对象不是特定的一个物体,暂不
设定。单击【KeepPosition】勾选,勾选后使释放的工件保持在当前释放
的空间位置。
(4) 添加信号与属性相关子组件,先创建一个非门信号组件
“LogicGate”和信号置位/复位组件“LogicSRLatch”。
(5) 子组件“LogicSRLatch”用于置位、复位信号,并且自带锁定
功能,执行默认设置,此处用于置位、复位的“抓取成功”的反馈信号;
组件“LogicGate”的【Operator】栏选为“Not”。

### 5. 设置属性连结
(1) 在【属性与连结】选项卡中单击【添加连结】,编辑下拉菜单选
择“LineSensor“作为源对象,“SensedPart“作为原属性,指的是线
传感器所检测到的与其发生的接触的物体。此连接将传感器检测到的物体作
为拾取目标对象【Attacher】。
(2) 同样操作添加“Attacher”作为源对象,原属性为:“Child”,
目标对象为:“Deteater”,目标属性为:“Child”。

### 6. 设置信号与连接
(1) 创建信号与连接分为两个方面:【I/O信号】通过【添加I/O
Signals】创建;【I/O连接】通过【添加I/O Connection】创建。
(2) 创建数字输入信号DIG1,
用于控制夹具拾取、释放动作,置
1为拾取工件,置0为释放工件;
创建数字输出信号DOG1,用于拾
取反馈信号,置1为拾取已成功,
置0为释放成功、拾取失败或者表
示未拾取状态。
(3) 激活传感器DIG1被置为1后,线传感器开始检测,如果检测到产
品,则执行拾取动作,夹具将产品拾取,并将抓取完成反馈信号DOG1置
为1,关闭抓取信号(DIG1被置为0)后,执行释放动作,产品被夹具释
放,执行放手动作,同时将抓取完成反馈信号DOG1置为0,机器人工具再
次运动到拾取位置去拾取下一个产品,循环运行。

---

## 导轨与变位机应用

### 1. 导轨应用
由于使用到机器人导轨,所以要安装与导轨相关的附加选项,在
ABB机器人有对应的ABB品牌导轨,在仿真软件设备库中可以调用仿真
并进行编程,下表是ABB机器人与导轨的匹配表。

**导轨型号** | **用于机器人型号**
------- | --------
IRBT 4004 | IRB 4400
IRBT 4004 | IRB 4400
IRBT 6004/7004 | IRB 6600/6620/6640/6700/7600
IRBT 2005 | IRB 1520, IRB 1600, IRB 2600, IRB 4600

### 1. 创建工作站
创建一个空的工作站,并导入机器人模型以及导轨模型,单击【基本】/
【ABB模型库】选择【IRB 6600】,导入机器人;单击【ABB模型库】,下
拉选择在【导轨】栏目单击中的【IRBT 6004】,导入导轨,行程选择
【5m】,其余默认,然后单击【确定】,导入导轨。
在【基本】功能选项卡的【布局】窗口将机器人安装到导轨上面,。
鼠标选中【机器人IRB6620】,其拖放到导轨【IRBT6004】上面,在
【更新位置】菜单中,单击【是】,将机器人位置更新到导轨基座上面,
在弹出的“机器人与导轨进行同步运动”菜单,单击【是】将机器人与导
轨进行同步运动,即机器人基坐标系随着导轨同步运动。
安装完成后,创建机器人系统。在创建带外轴的机器人系统时,建议使用
从布局创建系统,这样在创建的过程中,其系统会自动添加相应的控制选项以
及驱动选项,无需自己配置。在选项中添加机器人需要的选配功能,在系统相
关勾选时候,不要忘记勾选导轨。

### 2. 编程及仿真
将机器人原位置作为运动
的起始位置,通过示教目标点
将此位置记录下来,利用【手
动关节】控制机器人运动到另
一个位置,并记录该目标点,
然后通过【手动关节】拖动导
轨基座,正向移动至另外一点,
示教目标点,将此位置作为第
二个目标点。

---

## 2. 变位机应用

变位机可以改变工件的姿态。与导轨相比,变位机在另一个维度上拓
展了机器人工作站的工作范围,在工业机器人焊接、切割、涂胶等领域有
着广泛的应用。同导轨一样,变位机也必须与机器人相兼容。同一品牌的
机器人与变位机匹配较好,编程更容易;而若采用非标准或者不同品牌的
变位机与机器人组成工作站,就需要考虑编程同步的问题。

本节讲解ABB品牌机器人与ABB变位机虚拟工作站搭建控制的应用。
工作站配置:
*   机器人:ABB-IRB4600。
*   变位机:ABB-IRBP A250。
*   工件与治具:加载对应教学资源。
工作目标需求为工业机器人的焊接焊枪对两个弧形接触位置进行焊接。

### 1. 创建工作站
首先,创建机器人工作站,添加机器人“IRB4600”;然后添加变
位机,添加变位机操作同添加导轨相同。单击【ABB模型库】,下拉在
【变位机】类别中的单击选择【IRBP A250】,选择填选相应相应参数,
设定合适位置。
保证工件装配好,单击【基本】/【导入模型库】下拉菜单,在
【设备】中的【工具】里面选择【AW Gun_PSF_25】,并将工具安
装到机器人上。
单击【基本】/【导入几何体】浏览对应的自主资源,导入焊接工件和
工装组件,在左侧【布局】窗口中,左键选中拖到变位机上松开,安装到
变位机上,通过【基本】/【移动】功能按钮调节焊接工件组件在变位机
的位置。
为布局添加控制系统,统一控制机器人本体和变位机,方法参考给带
导轨的机器人添加控制系统方法。调节完成的变位机与机器人的工作位置。

### 2. 编程与仿真
首先有两条焊接轨迹也就是焊缝,焊接每一条焊缝需要示教点的位置:
*   home点:机器人安全点;
*   焊接进入点:焊接起始点上方位置;
*   焊接轨迹:弧线,通过圆弧运动执行焊接,需要示教起止位置和中间
    位置;下图为焊接轨迹起始位置。
*   逃离点:焊接停止位置上方点;
在带变位机的机器人系统中示教目标点时,需要保证变位机是激活状
态,才可同时将变位机的数据记录下来。单击【仿真】/【激活机械装置单
元】,勾选【STN1】,这样,在示教目标点时才可记录变位机关节数据。
通过右击变位机执行【机械装置手动关节】来调整变位机姿态,同时
机器人应移动工具,防止变位机及工件与机器人发生干涉碰撞。
对生成的焊接路径进行完善后,需要编写机器人的运动程序,并在其
中添加外轴控制指令ActUnit和DeactUnit,对变位机的激活和失效进行
控制。简单来说,就是在程序首行加入控制指令ActUnitSTN1,在程序
最后一行插入逻辑指令DeactUnitSTN1,代码入课本所示,最后运行仿
真工作站,观看仿真动画。

---

同学们下节课见!